import logging  # –î–æ–¥–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes

from handlers.base_handler import BaseHandler

logger = logging.getLogger(__name__)  # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥–µ—Ä–∞


# –í–∏–¥–∞–ª–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é escape_markdown_v2, –æ—Å–∫—ñ–ª—å–∫–∏ –º–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Markdown

class ManagerHandler(BaseHandler):
    @classmethod
    def register(cls, app, button_handler):
        # –†–µ—î—Å—Ç—Ä—É—î–º–æ callback –¥–ª—è –∫–Ω–æ–ø–∫–∏ 'FAQ'
        button_handler.register_callback('FAQ', cls.callback)
        # –ù–µ —Ä–µ—î—Å—Ç—Ä—É—î–º–æ —Ç—É—Ç 'menu', –≤—ñ–Ω –º–∞—î –±—É—Ç–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π –≤ StartHandler

    @staticmethod
    async def callback(update: Update, context: ContextTypes.DEFAULT_TYPE):

        # --- –§–æ—Ä–º—É—î–º–æ —Ç–µ–∫—Å—Ç –¥–ª—è FAQ —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π —Ç–µ–∫—Å—Ç ---
        # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Å–∏–º–≤–æ–ª–∏ –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞ '\n' –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
        # –ë–µ–∑ –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É, —Å–ø–∏—Å–∫—ñ–≤ –∞–±–æ —ñ–Ω—à–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ Markdown

        faq_text = "–ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è (FAQ)\n\n"  # –ó–∞–≥–æ–ª–æ–≤–æ–∫

        # –ü–∏—Ç–∞–Ω–Ω—è 1
        faq_text += "‚ùì –Ø–∫ —è –º–æ–∂—É –≤–∑—è—Ç–∏ —Ç–≤–∞—Ä–∏–Ω–∫—É –∑ –ø—Ä–∏—Ç—É–ª–∫—É?\n"
        faq_text += ("–ü—Ä–æ—Ü–µ—Å –∞–¥–æ–ø—Ü—ñ—ó –∑–∞–∑–≤–∏—á–∞–π –≤–∫–ª—é—á–∞—î:\n"
                     "1) –ü–µ—Ä–µ–≥–ª—è–¥ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Ç–≤–∞—Ä–∏–Ω –Ω–∞ –Ω–∞—à–æ–º—É —Å–∞–π—Ç—ñ (https://dogcat.com.ua/) –∞–±–æ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç—ñ;\n"
                     "2) –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∞–Ω–∫–µ—Ç–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –Ω–∞ –∞–¥–æ–ø—Ü—ñ—é (—ó—ó –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –ø—ñ–¥ –ø—Ä–æ—Ñ—ñ–ª–µ–º —Ç–≤–∞—Ä–∏–Ω–∫–∏ –∞–±–æ –Ω–∞ —Å–∞–π—Ç—ñ);\n"
                     "3) –°–ø—ñ–≤–±–µ—Å—ñ–¥—É –∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏–∫–æ–º –ø—Ä–∏—Ç—É–ª–∫—É;\n"
                     "4) –í—ñ–∑–∏—Ç –¥–æ –ø—Ä–∏—Ç—É–ª–∫—É –¥–ª—è –∑–Ω–∞–π–æ–º—Å—Ç–≤–∞ –∑ —Ç–≤–∞—Ä–∏–Ω–∫–æ—é;\n"
                     "5) –ü—ñ–¥–ø–∏—Å–∞–Ω–Ω—è –¥–æ–≥–æ–≤–æ—Ä—É –∞–¥–æ–ø—Ü—ñ—ó.\n\n")

        # –ü–∏—Ç–∞–Ω–Ω—è 2
        faq_text += "‚ùì –î–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤–∞—à –ø—Ä–∏—Ç—É–ª–æ–∫?\n"
        faq_text += ("–§–µ–¥–æ—Ä—ñ–≤–∫–∞, –ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å, 07372.\n"
                     "–ë—É–¥—å –ª–∞—Å–∫–∞, —É–∑–≥–æ–¥–∂—É–π—Ç–µ –≤–∞—à –≤—ñ–∑–∏—Ç –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å.\n\n")

        # –ü–∏—Ç–∞–Ω–Ω—è 3
        faq_text += "‚ùì –Ø–∫–∏–π –≥—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏ –ø—Ä–∏—Ç—É–ª–∫—É?\n"
        faq_text += "–ü–Ω-–ü—Ç –ó–∞—á–∏–Ω–µ–Ω–æ, –°–±-–ù–¥ 11:00-16:00.\n\n"

        # –ü–∏—Ç–∞–Ω–Ω—è 4
        faq_text += "‚ùì –Ø–∫ —â–µ —è –º–æ–∂—É –∑–≤'—è–∑–∞—Ç–∏—Å—è?\n"
        faq_text += ("üìû –¢–µ–ª–µ—Ñ–æ–Ω: +380931934069\n"
                     "üìß Email: dogcat.sirius@gmail.com\n"
                     "üí¨ –ú–µ–Ω–µ–¥–∂–µ—Ä: @manager_adopt\n\n")

        faq_text += "–Ø–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞–π—à–ª–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ —Å–≤–æ—î –ø–∏—Ç–∞–Ω–Ω—è, –±—É–¥—å –ª–∞—Å–∫–∞, –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏ –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–º–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∞–±–æ –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è —É –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é."

        keyboard = [
            [InlineKeyboardButton('–£ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é', callback_data='menu')],
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        # –ù–∞–º–∞–≥–∞—î–º–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—è–∫—â–æ —Ü–µ –±—É–≤ callback)
        if update.callback_query:
            try:
                await context.bot.delete_message(
                    chat_id=update.callback_query.message.chat_id,
                    message_id=update.callback_query.message.message_id
                )
            except Exception as e:
                logger.warning(f"Failed to delete previous message: {e}")

        # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ FAQ —Ç–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π —Ç–µ–∫—Å—Ç
        try:
            await context.bot.send_message(
                chat_id=update.effective_chat.id,
                text=faq_text,  # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç FAQ
                reply_markup=reply_markup,
                # –í–∏–¥–∞–ª–µ–Ω–æ parse_mode='MarkdownV2' - —Ç–µ–∫—Å—Ç –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π
            )
        except Exception as e:
            logger.error(f"–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ FAQ: {e}")
            await context.bot.send_message(
                chat_id=update.effective_chat.id,
                text="–ù–∞ –∂–∞–ª—å, –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –ß–∞—Å—Ç–∏—Ö –ø–∏—Ç–∞–Ω—å. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.",
            )
